(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["WorkFlowsEditor"],{"0726":function(t,e,s){},"29c5":function(t,e,s){"use strict";s("2ff7")},"2ff7":function(t,e,s){},3642:function(t,e,s){},3875:function(t,e,s){"use strict";s("3642")},4361:function(t,e,s){"use strict";s("ff49")},"59db":function(t,e,s){"use strict";s("693e")},"693e":function(t,e,s){},"7eb8":function(t,e,s){},"7f76":function(t,e,s){"use strict";s("7eb8")},"84c9":function(t,e,s){},b31e:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pai-work-flow"},t._l(t.tabs,(function(s,o){return e("work-editor-tab-panel",{directives:[{name:"show",rawName:"v-show",value:t.activeTabCode===s.code,expression:"activeTabCode === tab.code"}],key:o,staticStyle:{height:"calc(100% - 0px)"}},[e("work-editor",{attrs:{type:s.type}})],1)})),1)},i=[],n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pai-editor-tab-header"},t._l(t.tabs,(function(s,o){return e("div",{key:o,class:["pai-editor-tab-header",s.code===t.activeTabCode?"pai-editor-tab-header--active":""],style:!1===s.closeable?{paddingRight:"8px"}:{},on:{click:function(e){return t.$emit("update:activeTabCode",s.code)}}},[t._v(" "+t._s(s.name)+" "),!1!==s.closeable?e("i",{staticClass:"el-icon-close",on:{click:function(e){return t.onClickClose(o,s.code)}}}):t._e()])})),0)},a=[],r={props:{activeTabCode:String,tabs:Array},data(){return{}},methods:{onClickClose(t,e){this.$emit("close",t,e)}}},h=r,l=(s("29c5"),s("2877")),c=Object(l["a"])(h,n,a,!1,null,"9047e5b0",null),d=c.exports,u=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pai-editor-tab-pane"},[t._t("default")],2)},f=[],v={props:{activeTabName:String,tabs:Array},data(){return{}},methods:{onClickClose(t,e){this.$emit("close",t,e)}}},p=v,x=Object(l["a"])(p,u,f,!1,null,"398fb52c",null),y=x.exports,m=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pai-editor-tab-tool"},t._l(t.buttons,(function(s,o){return e("span",{key:o},[e("i",{class:["pai-iconfont",s.icon],on:{click:function(e){return t.onClick(s.type)}}}),t._v(" "+t._s(s.tip)+" ")])})),0)},w=[],C={props:{tab:Object},data(){return{buttons:[{icon:"pai-icon-baocun",tip:"保存",type:"save"},{icon:"pai-icon-tijiao",tip:"提交",type:"commit"}]}}},g=C,b=(s("caa0"),Object(l["a"])(g,m,w,!1,null,"62b89531",null)),M=b.exports,N=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pai-editor-wrap"},[e(t.componentNameMap[t.type],{tag:"component"})],1)},D=[],T=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pai-flow-editor"},[e("div",{staticClass:"pai-flow-editor__nodes"},t._l(t.nodes,(function(s,o){return e("div",{key:o},[e("div",{staticClass:"pai-flow-editor__nodes-group-name",on:{click:function(e){return t.onClickNodeGroup(s)}}},[e("i",{class:{"el-icon-arrow-down":!s.collapse,"el-icon-arrow-right":s.collapse},staticStyle:{"margin-right":"8px"}}),t._v(" "+t._s(s.title)+" ")]),e("div",{staticStyle:{transition:"all 0.3s",overflow:"hidden"},style:{height:s.collapse?0:28*s.children.length+"px"}},t._l(s.children,(function(s,i){return e("div",{key:o+"-"+i,staticClass:"pai-flow-editor__node",attrs:{draggable:""},on:{dragstart:e=>t.onDragstart(e,s),dragend:t.onDragend}},[t._v(" "+t._s(s.title)+" ")])})),0)])})),0),e("toolbar",{attrs:{getNodes:()=>t.$refs.flowsCanvas.getNodes()},on:{onSearch:e=>{t.$refs.flowsCanvas.setActiveNodeByCode(e)},layoutChange:e=>{t.$refs.flowsCanvas&&t.$refs.flowsCanvas.setLayout(e)},isSelection:e=>{e?t.$refs.flowsCanvas.setMouseMoveType("selection"):t.$refs.flowsCanvas.setMouseMoveType(null)},click:t.onClickTool}}),e("flows-canvas",{ref:"flowsCanvas",nativeOn:{dragover:function(e){return t.onDragover.apply(null,arguments)},dragleave:function(e){return t.onDragleave.apply(null,arguments)}}}),e("el-dialog",{attrs:{title:"新建节点",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{attrs:{"label-width":"60px"}},[e("el-form-item",{attrs:{label:"名称"}},[e("el-input",{model:{value:t.dropNode.name,callback:function(e){t.$set(t.dropNode,"name",e)},expression:"dropNode.name"}})],1)],1),e("div",{staticStyle:{"text-align":"right"}},[e("el-button",{on:{click:t.onConfirm}},[t._v("确定")])],1)],1)],1)},k=[],S=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{height:"100%",width:"100%",background:"#f8f9fb"}},[e("canvas",{ref:"canvas",on:{mousemove:t.onMouseMove,mousedown:t.onMouseDown,mouseup:t.onMouseUp,dblclick:t.onDbClick}})])},L=[];s("14d9");function P(t){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P(t)}s("d9e2");function _(t,e){if("object"!==P(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var o=s.call(t,e||"default");if("object"!==P(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function O(t){var e=_(t,"string");return"symbol"===P(e)?e:String(e)}function E(t,e,s){return e=O(e),e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class z{get lineFromPosition(){return"horizontal"===this.layout?{x:this.x+this.width,y:this.y+this.height/2}:{x:this.x+this.width/2,y:this.y+this.height}}get lineToPosition(){return"horizontal"===this.layout?{x:this.x,y:this.y+this.height/2}:{x:this.x+this.width/2,y:this.y}}constructor(){E(this,"name",""),E(this,"x",0),E(this,"y",0),E(this,"height",32),E(this,"width",160),E(this,"layout","vertical"),this.code=Math.random()+""}}class H extends z{constructor(){super(),E(this,"type","MySql"),E(this,"name","MySql"),E(this,"hasNextLink",!0),E(this,"hasLastLink",!0)}}class A extends z{constructor(){super(),E(this,"type","Shell"),E(this,"name","Shell")}}class I extends z{constructor(){super(),E(this,"type","OfflineSync"),E(this,"name","OfflineSync"),E(this,"hasLastLink",!0)}}class X extends z{constructor(){super(),E(this,"type","Sync"),E(this,"name","Sync")}}class Y{constructor(t,e){E(this,"type","line"),this.fromNode=t,this.toNode=e}get y1(){return-this.fromNode.lineFromPosition.y}get y2(){return-this.toNode.lineToPosition.y}get x1(){return this.fromNode.lineFromPosition.x}get x2(){return this.toNode.lineToPosition.x}get k(){return(this.y1-this.y2)/(this.x1-this.x2)}get b(){return this.y1-this.k*this.x1}getLinearEquationInOne(t){return this.k*t+this.b}}var F={MySql:H,Shell:A,OfflineSync:I,Sync:X};class ${constructor(t){this.canvasContext=t}write({context:t,x:e,y:s,font:o,fillStyle:i="#fff",textBaseline:n="bottom",textAlign:a="left",setOverflow:r,overflowWidth:h}){r&&(t=this.getOverflowText(t,o,h)),this.canvasContext.textBaseline=n,this.canvasContext.fillStyle=i,this.canvasContext.textAlign=a,this.canvasContext.font=o,this.canvasContext.fillText(t,e,s)}getOverflowText(t,e,s){s||(s=this.canvasContext.canvas.width),this.canvasContext.save(),this.canvasContext.font=e;let o=this.canvasContext.measureText(t).width;if(o>s){while(this.canvasContext.measureText(t+"...").width>s)t=t.slice(0,t.length-1);t+="..."}return this.canvasContext.restore(),t}}class j{constructor(t){this.canvasContext=t,this.fillTextClass=new $(this.canvasContext),this.radius=6,this.dotSize=10,this.scale=1}isPointInNode(t,e,s){let{x:o,y:i,width:n,height:a}=s,r={x:s.lineFromPosition.x-this.dotSize/2,y:s.lineFromPosition.y-this.dotSize/2,height:this.dotSize,width:this.dotSize},h={x:s.lineToPosition.x-this.dotSize/2,y:s.lineToPosition.y-this.dotSize/2,height:this.dotSize,width:this.dotSize},l=t>o&&t<o+n&&e>i&&e<i+a,c=!1,d=!1;const u=s=>t>s.x&&t<s.x+s.width&&e>s.y&&e<s.y+s.height;return s.hasNextLink&&(c=u(r)),s.hasLastLink&&(d=u(h)),{isHover:l||c||d,isHoverInNode:l,isHoverInNextLinkDot:c,isHoverInLastLinkDot:d}}drawShadow(t,e,s,o){this.canvasContext.shadowOffsetX=t,this.canvasContext.shadowOffsetY=e,this.canvasContext.shadowBlur=s,this.canvasContext.shadowColor=o}drawVirtualNode(t){this.canvasContext.beginPath(),this.canvasContext.save(),this.canvasContext.setLineDash([5,5]);let{x:e,y:s,width:o,height:i}=t;this.canvasContext.strokeStyle="#1890FF",this.canvasContext.lineWidth=1,this.canvasContext.rect(e,s,o,i),this.canvasContext.stroke(),this.canvasContext.restore(),this.canvasContext.closePath()}drawBox(t){let e=this.radius,{x:s,y:o,width:i,height:n,isActive:a,isHover:r,isGroupActive:h}=t;this.canvasContext.save(),this.canvasContext.beginPath();let l="#D8DBEA",c="rgba(0,0,0,0.1)";r&&(l="#96A6B5"),(a||h)&&(l="#1890FF",c="rgba(24,144,255, 0.1)");let d=10;this.drawShadow(0,4,d,c),this.canvasContext.strokeStyle=l,this.canvasContext.lineWidth=1,this.canvasContext.fillStyle="#fff",this.canvasContext.moveTo(s+e,o),this.canvasContext.lineTo(s+i-e,o),this.canvasContext.arcTo(s+i,o,s+i,o+e,e),this.canvasContext.lineTo(s+i,o+n-e),this.canvasContext.arcTo(s+i,o+n,s+i-e,o+n,e),this.canvasContext.lineTo(s+e,o+n),this.canvasContext.arcTo(s,o+n,s,o+n-e,e),this.canvasContext.lineTo(s,o+e),this.canvasContext.arcTo(s,o,s+e,o,e),this.canvasContext.stroke(),this.canvasContext.fill(),this.canvasContext.closePath(),this.canvasContext.restore()}drawDot(t,e,s){this.canvasContext.save(),this.canvasContext.beginPath(),this.canvasContext.strokeStyle="#1890FF",this.canvasContext.lineWidth=1,this.canvasContext.arc(t,e,s||this.dotSize/2,0,2*Math.PI),this.canvasContext.fillStyle="#fff",this.canvasContext.stroke(),this.canvasContext.fill(),this.canvasContext.closePath(),this.canvasContext.restore()}drawNextLinkDot(t){let{isHover:e,isHoverDot:s}=t;(e||s)&&this.drawDot(t.lineFromPosition.x,t.lineFromPosition.y)}drawLastLinkDot(t){let{isHoverInLastLinkDot:e,showLineToDot:s}=t;e&&this.drawDot(t.lineToPosition.x,t.lineToPosition.y,this.dotSize/2+2),s&&this.drawDot(t.lineToPosition.x,t.lineToPosition.y)}draw(t){let{x:e,y:s,width:o,height:i}=t;this.drawBox(t),t.showLineToDot?this.drawLastLinkDot(t):t.showLineFromDot&&this.drawNextLinkDot(t),this.fillTextClass.write({context:t.name,x:e+o/2,y:s+i/2,font:"normal 400 12px PingFangSC-Medium",fillStyle:"#79879C",textBaseline:"middle",textAlign:"center",setOverflow:!0,overflowWidth:o})}}var V=j;class Z{constructor(t){this.canvasContext=t,this.arrowSize=8,this.scale=1}get arrowHeight(){return Math.sqrt(Math.pow(this.arrowSize,2)-Math.pow(this.arrowSize/2,2))}isPointInLine(t,e){let s=this.canvasContext.getImageData(t,e,1,1),[o,i,n]=s.data,a=(t,e,s)=>t>e&&t<s;return!!(a(o,148,152)&&a(i,164,168)&&a(n,179,183)||a(o,22,26)&&a(i,142,146)&&a(n,253,257))}drawArrow(t,e,s){this.canvasContext.moveTo(t,e),"horizontal"===s?(this.canvasContext.lineTo(t-this.arrowHeight,e-this.arrowSize/2),this.canvasContext.lineTo(t-this.arrowHeight,e+this.arrowSize/2),this.canvasContext.lineTo(t,e)):(this.canvasContext.lineTo(t+this.arrowSize/2,e-this.arrowHeight),this.canvasContext.lineTo(t-this.arrowSize/2,e-this.arrowHeight),this.canvasContext.lineTo(t,e)),this.canvasContext.fill()}draw({sx:t,sy:e,ex:s,ey:o},i={}){let{arrow:n,isHover:a,isActive:r,layout:h}=i;n&&("horizontal"===h?s-=this.arrowHeight:o-=this.arrowHeight);let l=Math.min(20,Math.abs(e-o)),c={x:t,y:e+l},d={x:s,y:o-l};this.canvasContext.beginPath(),this.canvasContext.strokeStyle=r?"#1890FF":"#96A6B5",this.canvasContext.lineWidth=a||r?2:1.3,this.canvasContext.moveTo(t,e),this.canvasContext.bezierCurveTo(c.x,c.y,d.x,d.y,s,o),this.canvasContext.stroke(),this.canvasContext.closePath(),this.canvasContext.beginPath(),n&&("horizontal"===h?(s+=this.arrowHeight,this.drawArrow(s,o,i.layout)):(o+=this.arrowHeight,this.drawArrow(s,o,i.layout))),this.canvasContext.closePath()}}var q=Z,G={data(){return{scale:1}},watch:{scale(t,e){this.canvasContext.scale(1/e,1/e),this.canvasContext.scale(t,t),this.nodeDrawerClass.scale=t,this.lineDrawerClass.scale=t,this.destoryContextMenu()}},methods:{scaleIn(){this.scale=Math.min(this.scale+.1,2)},scaleOut(){this.scale=Math.max(this.scale-.1,.5)}}};class W{constructor({type:t,node:e,offsetX:s,offsetY:o,events:i={}}){this.type=t,this.node=e,this.offsetX=s,this.offsetY=o,this.container=document.querySelector(".pai-flow-editor"),this.events=i,this.append()}setStyle(t){Object.keys(t).forEach(e=>{this.contextMenuDom.style[e]=t[e]})}createMenu(t,e=(()=>{})){let s=document.createElement("div");return s.innerHTML=t,s.onclick=()=>{e(),this.destory()},s}createLine(){let t=document.createElement("span");return t}append(){this.contextMenuDom=document.createElement("div"),this.contextMenuDom.oncontextmenu=t=>t.preventDefault(),this.setStyle({position:"absolute",left:this.offsetX+"px",top:this.offsetY+"px"}),this.contextMenuDom.classList.add("pai-flow-editor-context-menu"),"node"===this.type?this.contextMenuDom.appendChild(this.createMenu("打开节点",()=>{this.events.open&&this.events.open(this.node)})):"line"===this.type&&this.contextMenuDom.appendChild(this.createMenu("删除")),this.container.appendChild(this.contextMenuDom)}destory(){try{this.container.removeChild(this.contextMenuDom)}catch(t){}}}var B={methods:{getContextMenuEvents(){return{open:t=>{console.log(t)}}},setContextMenu(t){let{offsetX:e,offsetY:s}=this.calcPoint(t),o=null,i=null;this.nodes.forEach(t=>{t.isActive=!1;let{isHover:i}=this.nodeDrawerClass.isPointInNode(e,s,t);i&&(o=t)}),o?this.contextMenu=new W({type:"node",node:o,offsetX:t.offsetX,offsetY:t.offsetY,events:this.getContextMenuEvents()}):this.lineDrawerClass.isPointInLine(t.offsetX,t.offsetY)&&(i=this.findMostCloseLine(t),this.contextMenu=new W({type:"line",node:i,offsetX:t.offsetX,offsetY:t.offsetY,events:this.getContextMenuEvents()}))},destoryContextMenu(){this.contextMenu&&(this.contextMenu.destory(),this.contextMenu=null)}}},R={methods:{openNode(t){this.topParent.$emit("openNode",t)}}},J={mixins:[G,B,R],inject:["topParent"],props:{mode:{type:String,default:"edit"}},computed:{readonly(){return"preview"===this.mode}},mounted(){this.initCanvas(),window.addEventListener("resize",this.onResize)},beforeDestroy(){window.cancelAnimationFrame(this.requestAnimationFrameId),window.removeEventListener("resize",this.onResize)},data(){return{nodes:[],lines:[],mouseMoveType:"",layout:"vertical"}},methods:{getNodes(){return this.nodes.map(t=>Object.assign({},t))},setLayout(t){this.destoryContextMenu(),this.layout=t,this.nodes.forEach(e=>e.layout=t)},setActiveNodeByCode(t){this.destoryContextMenu();let e=null;this.nodes.forEach(s=>{s.isActive=!1,s.isGroupActive=!1,s.taskCode===t&&(s.isActive=!0,e=s)}),this.moveNodeToCenter(e)},moveNodeToCenter(t){this.destoryContextMenu();let e,s,o,i,n,a,r=180,h=(this.canvas.width-r)/2,l=this.canvas.height/2;this.nodes.forEach(n=>{n.x*=this.scale,n.y*=this.scale,t||(e=Math.min(n.x,e||n.x),s=Math.max(n.x+n.width,s||n.x+n.width),o=Math.min(n.y,o||n.y),i=Math.max(n.y+n.height,i||n.y+n.height))}),t?(n=t.x-h-r,a=t.y-l):(n=(e+s)/2-h-r,a=(o+i)/2-l),this.nodes.forEach(t=>{t.x-=n,t.y-=a,t.x/=this.scale,t.y/=this.scale})},centerNodes(){this.moveNodeToCenter()},onResize(){this.destoryContextMenu(),this.canvas.width=this.$el.offsetWidth,this.canvas.height=this.$el.offsetHeight,this.canvasContext.scale(this.scale,this.scale)},findMostCloseLine(t){let{offsetX:e,offsetY:s}=this.calcPoint(t),o=null,i=null;return this.lines.forEach(t=>{let n=Math.abs(t.getLinearEquationInOne(e)- -s);(null===i||i>n)&&(i=n,o=t)}),o},setMouseMoveType(t){this.mouseMoveType=t},resetMouseEventData(){this.isMouseDown=!1,this.mouseDownedNode=null,this.movingVirtualNode=null,this.drawingLine=null,this.isMoving=!1,"selection"!==this.mouseMoveType&&this.setMouseMoveType(null),this.nodes.forEach(t=>{t.showLineToDot=!1,t.showLineFromDot=!1,t.isHoverInLastLinkDot=!1})},onDbClick(){this.openNode(this.mouseDownedNode)},onMouseUp(t){if(this.readonly)return void this.resetMouseEventData();let{offsetX:e,offsetY:s}=this.calcPoint(t);this.startOffsetX===e&&this.startOffsetY===s&&(this.mouseDownedNode&&(this.mouseDownedNode.isActive=!0),this.mouseDownedLine&&(this.mouseDownedLine.isActive=!0)),this.movingVirtualNode&&(this.mouseDownedNode&&"moveNode"===this.mouseMoveType&&Object.assign(this.mouseDownedNode,this.movingVirtualNode),"moveGroupNode"===this.mouseMoveType&&this.groupNodes&&this.groupNodes.forEach(t=>{t.x+=e-this.startOffsetX,t.y+=s-this.startOffsetY})),this.drawingLine&&this.drawingLine.fromNode&&this.drawingLine.toNode&&this.lines.push(new Y(this.drawingLine.fromNode,this.drawingLine.toNode)),this.selectionZone&&(this.nodes.forEach(t=>{t.isGroupActive=!1;let e=Math.min(this.selectionZone.sx,this.selectionZone.ex),s=Math.max(this.selectionZone.sx,this.selectionZone.ex),o=Math.min(this.selectionZone.sy,this.selectionZone.ey),i=Math.max(this.selectionZone.sy,this.selectionZone.ey);t.x>e&&t.x<s&&t.y>o&&t.y<i&&(t.isGroupActive=!0)}),this.selectionZone=null),setTimeout(()=>{this.resetMouseEventData()}),this.isClickMouseRight&&this.setContextMenu(t)},calcPoint(t){let{offsetX:e,offsetY:s}=t;return{offsetX:e/this.scale,offsetY:s/this.scale}},onMouseDown(t){this.destoryContextMenu();let{offsetX:e,offsetY:s}=this.calcPoint(t);this.isClickMouseRight=2===t.button,this.isMouseDown=!0,this.startOffsetX=e,this.startOffsetY=s,this.mouseDownedNode=null,this.mouseDownedLine=null,this.selectionZone=null,this.groupNodes=[],this.nodes.forEach(t=>{t.originX=t.x,t.originY=t.y,t.isActive=!1;let{isHover:o,isHoverInNode:i,isHoverInNextLinkDot:n}=this.nodeDrawerClass.isPointInNode(e,s,t);o&&(this.mouseDownedNode=t),"selection"!==this.mouseMoveType&&(i&&this.setMouseMoveType("moveNode"),n&&this.setMouseMoveType("drawLine"),t.isGroupActive&&(this.setMouseMoveType("moveGroupNode"),this.groupNodes.push(t)))}),this.lines.forEach(t=>{t.isActive=!1}),this.mouseDownedNode?(this.originMmouseDownedNodeX=this.mouseDownedNode.x,this.originMmouseDownedNodeY=this.mouseDownedNode.y):(this.nodes.forEach(t=>{t.isGroupActive=!1,"moveGroupNode"===this.mouseMoveType&&(this.setMouseMoveType(""),this.groupNodes=[])}),this.lineDrawerClass.isPointInLine(t.offsetX,t.offsetY)&&(this.mouseDownedLine=this.findMostCloseLine(t))),this.mouseDownedNode||this.moustCloseLine||"selection"!==this.mouseMoveType&&this.setMouseMoveType("moveCanvas")},onMouseMove(t){if(this.readonly&&"moveCanvas"!==this.mouseMoveType)return;let{offsetX:e,offsetY:s}=this.calcPoint(t);this.isMoving=!0;let o,i,n,a,r=null,h=null;if(this.nodes.forEach(t=>{t.isHover=!1;let{isHover:h,isHoverInLastLinkDot:l}=this.nodeDrawerClass.isPointInNode(e,s,t);h&&(r=t),t.hasNextLink&&(t.showLineFromDot=!0),"drawLine"===this.mouseMoveType?t.hasLastLink&&(t.showLineToDot=!0,t.showLineFromDot=!1,t.isHoverInLastLinkDot=l):"moveGroupNode"===this.mouseMoveType&&t.isGroupActive&&(o=o?Math.min(t.x,o):t.x,i=i?Math.min(t.y,i):t.y,n=n?Math.max(t.x+t.width,n):t.x+t.width,a=a?Math.max(t.y+t.height,a):t.y+t.height)}),!r){this.lines.forEach(t=>t.isHover=!1);let e=this.lineDrawerClass.isPointInLine(t.offsetX,t.offsetY);e&&(h=this.findMostCloseLine(t))}r||h?(r&&(r.isHover=!0),h&&(h.isHover=!0),this.$el.style.cursor="pointer"):this.$el.style.cursor="default",this.isClickMouseRight||("moveCanvas"===this.mouseMoveType?this.nodes.forEach(t=>{t.x=t.originX+e-this.startOffsetX,t.y=t.originY+s-this.startOffsetY}):"moveNode"===this.mouseMoveType?e===this.startOffsetX&&s===this.startOffsetY||(this.movingVirtualNode=Object.assign({},this.mouseDownedNode,{x:this.originMmouseDownedNodeX+e-this.startOffsetX,y:this.originMmouseDownedNodeY+s-this.startOffsetY})):"moveGroupNode"===this.mouseMoveType?e===this.startOffsetX&&s===this.startOffsetY||(this.movingVirtualNode=Object.assign({width:n-o,height:a-i},{x:o+e-this.startOffsetX,y:i+s-this.startOffsetY})):"drawLine"===this.mouseMoveType?(this.mouseDownedNode.showLineToDot=!1,this.mouseDownedNode.showLineFromDot=!0,this.drawingLine={fromNode:this.mouseDownedNode,toNode:r&&r.isHoverInLastLinkDot?r:null,position:{sx:this.mouseDownedNode.lineFromPosition.x,sy:this.mouseDownedNode.lineFromPosition.y,ex:e,ey:s}}):"selection"===this.mouseMoveType&&this.isMouseDown&&(this.selectionZone={sx:this.startOffsetX,sy:this.startOffsetY,ex:e,ey:s}))},clearCanvas(){this.canvasContext.clearRect(0,0,this.canvas.width/this.scale,this.canvas.height/this.scale)},addNode(t,e){let{offsetX:s,offsetY:o}=this.calcPoint(t),i=F[e.nodeType],n=new i;n.layout=this.layout,n.x=s,n.y=o,n.name=e.name||n.name,this.nodes.push(n)},initCanvas(){this.canvas=this.$refs.canvas,this.canvas.width=this.$el.offsetWidth,this.canvas.height=this.$el.offsetHeight,this.canvasContext=this.canvas.getContext("2d"),this.nodeDrawerClass=new V(this.canvasContext),this.lineDrawerClass=new q(this.canvasContext);const t=()=>{this.draw(),this.requestAnimationFrameId=window.requestAnimationFrame(t)};t()},draw(){this.clearCanvas(),this.lines.forEach(t=>{let{fromNode:e,toNode:s}=t;this.lineDrawerClass.draw({sx:e.lineFromPosition.x,sy:e.lineFromPosition.y,ex:s.lineToPosition.x,ey:s.lineToPosition.y},{arrow:!0,isActive:t.isActive,isHover:t.isHover,layout:this.layout})}),this.nodes.forEach(t=>{this.nodeDrawerClass.draw(t)}),this.movingVirtualNode&&this.nodeDrawerClass.drawVirtualNode(this.movingVirtualNode),this.drawingLine&&this.lineDrawerClass.draw(this.drawingLine.position),this.selectionZone&&(this.canvasContext.beginPath(),this.canvasContext.rect(Math.min(this.selectionZone.sx,this.selectionZone.ex),Math.min(this.selectionZone.sy,this.selectionZone.ey),Math.abs(this.selectionZone.ex-this.selectionZone.sx),Math.abs(this.selectionZone.ey-this.selectionZone.sy)),this.canvasContext.save(),this.canvasContext.fillStyle="rgba(0,0,0,0.05)",this.canvasContext.strokeStyle="rgba(0,0,0,0.1)",this.canvasContext.stroke(),this.canvasContext.fill(),this.canvasContext.restore(),this.canvasContext.closePath())}}},U=J,K=(s("3875"),Object(l["a"])(U,S,L,!1,null,null,null)),Q=K.exports,tt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pai-flow-editor-toolbar"},t._l(t.buttons,(function(s,o){return e("el-tooltip",{key:o,attrs:{effect:"dark",content:s.tip,placement:"top"}},["layout"===s.type?e("el-popover",{attrs:{placement:"bottom",title:"",width:"210",trigger:"hover"}},[e("el-radio-group",{model:{value:t.layout,callback:function(e){t.layout=e},expression:"layout"}},[e("el-radio-button",{attrs:{label:"grid"}},[t._v("网格")]),e("el-radio-button",{attrs:{label:"horizontal"}},[t._v("横向")]),e("el-radio-button",{attrs:{label:"vertical"}},[t._v("纵向")])],1),e("i",{attrs:{slot:"reference"},slot:"reference"},[t._v(t._s(s.tip))])],1):t._e(),"search"===s.type?e("el-popover",{attrs:{placement:"bottom",title:"",width:"300",trigger:"hover"},on:{show:t.onShowSearchPanel}},[e("el-input",{attrs:{placeholder:"请输入搜索内容"},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}}),e("div",{staticClass:"pai-flow-editor-toolbar__nodes"},t._l(t.searchNodes.filter(e=>!t.searchValue||e.name.includes(t.searchValue)),(function(s,o){return e("div",{key:o,class:{"pai-flow-editor-toolbar__node":!0,"pai-flow-editor-toolbar__node--active":t.activeSearchNode===s.taskCode},on:{click:function(e){return t.onClickSearchNode(s)}}},[t._v(" "+t._s(s.name)+" ")])})),0),e("i",{attrs:{slot:"reference"},slot:"reference"},[t._v(t._s(s.tip))])],1):e("span",[e("i",{class:["selection"===s.type&&t.isSelection?"pai-flow-editor-toolbar--active":""],on:{click:function(e){return t.onClick(s.type)}}},[t._v(t._s(s.tip))])])],1)})),1)},et=[],st={props:{getNodes:{type:Function}},watch:{layout:{immediate:!0,handler(t){this.$emit("layoutChange",t)}}},methods:{onClickSearchNode({taskCode:t}){this.activeSearchNode=t,this.$emit("onSearch",t)},onShowSearchPanel(){this.searchValue="",this.activeSearchNode="",this.searchNodes=this.getNodes()},onClick(t){"selection"===t&&(this.isSelection=!this.isSelection,this.$emit("isSelection",this.isSelection)),this.$emit("click",t)}},data(){return{searchValue:"",activeSearchNode:"",searchNodes:[],layout:"vertical",isSelection:!1,buttons:[{icon:"pai-icon-caozuo-kuangxuan",tip:"框选",type:"selection"},{icon:"pai-icon-kapianshi",tip:"格式化",type:"format"},{icon:"pai-icon-caozuo-shipeipingmu",tip:"适配屏幕",type:"fit"},{icon:"pai-icon-caozuo-juzhong",tip:"居中",type:"center"},{icon:"pai-icon-caozuo-1bi1",tip:"1:1",type:"1:1"},{icon:"pai-icon-caozuo-fangda",tip:"放大",type:"scaleIn"},{icon:"pai-icon-caozuo-suoxiao",tip:"缩小",type:"scaleOut"}]}}},ot=st,it=(s("4361"),s("7f76"),Object(l["a"])(ot,tt,et,!1,null,"ce78b6fa",null)),nt=it.exports,at={components:{FlowsCanvas:Q,Toolbar:nt},methods:{onClickTool(t){let e={scaleIn:()=>{this.$refs.flowsCanvas.scaleIn()},scaleOut:()=>{this.$refs.flowsCanvas.scaleOut()},"1:1":()=>{this.$refs.flowsCanvas.scale=1,this.$refs.flowsCanvas.centerNodes()},center:()=>{this.$refs.flowsCanvas.centerNodes()}};e[t]&&e[t]()},onConfirm(){this.$refs.flowsCanvas.addNode(this.dropOffset,this.dropNode),this.dialogVisible=!1},clearDragInfo(){this.isDropInCanvas=!1},onDragend(){this.isDropInCanvas&&(this.dialogVisible=!0),this.clearDragInfo()},onDragover(t){this.isDropInCanvas=!0,this.dropOffset={offsetX:t.offsetX,offsetY:t.offsetY},t.preventDefault()},onDragleave(){this.clearDragInfo()},onDragstart(t,e){this.dropNode=e},onClickNodeGroup(t){t.collapse=!t.collapse,this.nodes=this.nodes.map(t=>t)}},data(){return{dialogVisible:!1,isDropInCanvas:!1,dropOffset:{},dropNode:{},nodes:[{title:"节点组1",children:[{title:"可拖拽节点1",nodeType:"MySql"},{title:"可拖拽节点2",nodeType:"MySql"}]},{title:"节点组2",children:[{title:"可拖拽节点3",nodeType:"MySql"},{title:"可拖拽节点4",nodeType:"MySql"}]}]}}},rt=at,ht=(s("ebcb"),Object(l["a"])(rt,T,k,!1,null,"18e53a5a",null)),lt=ht.exports,ct=function(){var t=this,e=t._self._c;return e("div")},dt=[],ut={},ft=ut,vt=Object(l["a"])(ft,ct,dt,!1,null,null,null),pt=vt.exports,xt={props:{type:String},data(){return{componentNameMap:{workflow:"flows-editor",mysql:"my-sql-editor"}}},inject:["topParent"],components:{FlowsEditor:lt,MySqlEditor:pt}},yt=xt,mt=(s("c5d6"),Object(l["a"])(yt,N,D,!1,null,"c8af0d36",null)),wt=mt.exports,Ct={components:{WorkEditorTabHeader:d,WorkEditor:wt,WorkEditorTabPanel:y,WorkEditorTabTool:M},provide(){return{topParent:this}},mounted(){this.$on("openNode",this.openNode)},beforeDestroy(){this.$off("openNode",this.openNode)},computed:{activeTab(){return this.tabs.find(t=>t.code===this.activeTabCode)}},methods:{openNode(t){},onCloseTab(t,e){this.tabs.splice(t,1),this.activeTabCode===e&&(this.activeTabCode=this.tabs[0].code)}},data(){return{activeTabCode:"workflow",tabs:[{name:"workflow",type:"workflow",code:"workflow",closeable:!1}]}}},gt=Ct,bt=(s("59db"),Object(l["a"])(gt,o,i,!1,null,"d1fb0194",null));e["default"]=bt.exports},c5d6:function(t,e,s){"use strict";s("c67e")},c67e:function(t,e,s){},caa0:function(t,e,s){"use strict";s("0726")},ebcb:function(t,e,s){"use strict";s("84c9")},ff49:function(t,e,s){}}]);